# Phobos – Sandboxing for Programming Exercises

## Overview

Phobos is a sandboxing solution for the [Artemis](https://github.com/ls1intum/Artemis) e-learning platform, designed to securely run student code tests by restricting filesystem and network access to only what’s necessary. It works in two phases:
- **Resource Discovery (Pruning)** Phase: An offline phase where Phobos automatically discovers which files, directories, and external network hosts are truly needed for the tests to run. It does this by running sample exercises in an instrumented environment and “pruning” away unnecessary resources, producing a whitelist of required paths and allowed network endpoints.
- **Application (Sandboxing) Phase**: The runtime phase where Phobos is applied to student submissions. The tests execute inside a confined environment (using Linux namespaces via [**Bubblewrap**](https://github.com/containers/bubblewrap) that only exposes the whitelisted files (mostly in read-only mode) and blocks all other files by mounting empty directories (tmpfs). Network access is similarly constrained using a custom preload library (“netblocker”) that intercepts network calls and only allows connections to whitelisted hosts. This ensures student code cannot access undeclared resources or external services beyond what’s been approved.

By integrating Phobos with Artemis, instructors and administrators can run student tests with greater security and academic integrity. Phobos extends Artemis’s existing test infrastructure (e.g. Maven/Gradle, pytest, etc.) with an additional layer of sandboxing without requiring changes to the tests themselves, by wrapping the normal test execution inside the sandbox.

## Repository Structure and Components
The project is organized into components for the two phases:
- **Pruning (Resource Discovery)** Tools: Located primarily under the `docker/prune_phase` directory (and associated scripts in the repository). This includes the orchestrator script and any Docker configurations needed to run the discovery phase. The repository also contains example output files under a `var/tmp` structure (e.g. path whitelist files) which illustrate the results of pruning.
- **Phobos Core (Sandbox Runtime)**: Located in the `core/` directory. These are the scripts and binaries used during the sandboxing phase. Notable contents include:
  - `phobos.sh:` The main entry-point script to apply Phobos sandboxing when running tests. It sets up the restricted environment (file binds, network rules) and then invokes the actual build/test commands inside that sandbox.
  - `libnetblocker.so`: The compiled netblocker library used for network call interception. This library is preloaded into the test process to hook network-related system calls (e.g. DNS resolution and socket connect). It ensures only allowed hostnames/IPs can be contacted, blocking others by failing DNS lookup or connect calls.
  - **Whitelist Files**: The allow-list of file system paths that were generated by the pruning phase. These might be provided as `*.paths` files (e.g. `java_union.paths`, `python_union.paths`, etc.) under a directory (e.g. `var/tmp/path_sets/` in the repo). They enumerate directories with required access mode – e.g. lines starting with `r` for read-only binds or `w` for writable binds. Phobos uses these to know which directories to mount in the sandbox.
  - **Dockerfiles**: The repository contains Dockerfile(s) for building the Phobos Docker images. For example, a Dockerfile extends Artemis’s base test image (such as the `ls1tum/artemis-maven-template` for Java) by adding the Phobos core files and any needed dependencies (like Bubblewrap). The Docker image published (e.g. `ajayvir/phobos` on Docker Hub for Java) includes all Phobos components and config pre-installed on top of the standard Artemis test environment.
- **Miscellaneous**: Additional scripts or configs for advanced usage, e.g. an orchestrator script (`orchestrate.py`) to coordinate multi-language pruning (explained below), and configuration hooks for special cases (skip patterns, forced binds, etc., as discovered during development).
